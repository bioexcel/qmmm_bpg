<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>System preparation &mdash; (GROMACS+)CP2K QM/MM Best Practice Guide  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Selecting QM atoms" href="selecting_qm_atoms.html" />
    <link rel="prev" title="QM/MM overview" href="../overview/overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> (GROMACS+)CP2K QM/MM Best Practice Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">QM/MM overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System preparation:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">System preparation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-to-know-your-biological-system">Getting to know your biological system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-your-pdb-file">Preparing your PDB file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cleaning-the-structural-coordinates-of-the-biomolecule-of-interest">Cleaning the structural coordinates of the biomolecule of interest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assessing-the-protonation-states-of-your-biomolecule">Assessing the protonation states of your biomolecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-for-disulphide-bonds-and-other-posttranslational-modifications">Checking for disulphide bonds and other posttranslational modifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#presence-of-chromophores-cofactors-substrates-inhibitors-and-other-organic-molecules">Presence of chromophores, cofactors, substrates, inhibitors and other organic molecules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-topology-and-coordinate-files-for-cp2k">Preparing topology and coordinate files for CP2K</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#system-preparation-using-ambertools-software-package">System preparation using AMBERTools software package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-preparation-using-charmm-software-package">System preparation using CHARMM software package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="selecting_qm_atoms.html">Selecting QM atoms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input preparation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../input_preparation/CP2K_MM_setup.html">CP2K MM setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input_preparation/QM_treatment.html">QM treatment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input_preparation/CP2K_QMMM_parameterisation.html">CP2K QM/MM parameterisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input_preparation/interface_QMMM_parameterisation.html">GROMACS/CP2K interface QM/MM parameterisation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Running:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../running_cp2k/building_cp2k.html">Building CP2K</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_cp2k/running_cp2k.html">Running QM/MM simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_cp2k/cp2k_output.html">Understanding the CP2K output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_cp2k/cp2k_errors.html">CP2K Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">(GROMACS+)CP2K QM/MM Best Practice Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>System preparation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/system_preparation/system_preparation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="system-preparation">
<h1>System preparation<a class="headerlink" href="#system-preparation" title="Permalink to this heading"></a></h1>
<p>In this guide, we are going to briefly explain how to prepare your biological systems starting from a PDB file in the Protein Data Bank to obtaining topology and coordinates files ready to use in CP2K.</p>
<p>You may also like to consult our guide on Best Practices in QM/MM Simulation of Biomolecular Systems, which gives advice on QM/MM methodology that is independent of the software used: <a class="reference external" href="https://docs.bioexcel.eu/qmmm_simulation_bpg">https://docs.bioexcel.eu/qmmm_simulation_bpg</a></p>
<section id="getting-to-know-your-biological-system">
<h2>Getting to know your biological system<a class="headerlink" href="#getting-to-know-your-biological-system" title="Permalink to this heading"></a></h2>
<p>Biological molecules are complex systems as they have evolved to react to changes in their chemical environment such as pH, concentration of substrates or voltage across biological membranes. All the factors that can tune the biological activity of interest must be taken into account for molecular modelling purposes. Therefore, a thorough literature search before starting your simulation will help you figure out which is the chemical environment of your biological system.</p>
<p>In particular, QM/MM methods are often used to study chemical reactions catalysed by enzymes, light absorption through chromophores within proteins, reduction and/or oxidation of cofactors and much more. To study the aforementioned biological processes, it is crucial to known the fine details involved such as the protonation states and the geometry of the residues involved in the reaction, the presence of water molecules, the oxidation state of the chromophore or cofactor, coordination geometry of the metal ions involved… This structural information will also help to determine:</p>
<ul class="simple">
<li><p>The reaction coordinate that defines the chemical process of interest.</p></li>
<li><p>The starting configuration of your biological system.</p></li>
<li><p>Which DFT method to use.</p></li>
<li><p>How big the QM region must be.</p></li>
</ul>
</section>
<section id="preparing-your-pdb-file">
<h2>Preparing your PDB file<a class="headerlink" href="#preparing-your-pdb-file" title="Permalink to this heading"></a></h2>
<p>The most common way to obtain the structure of a biomolecule (proteins, nucleic acids, protein complexes…) is  via a structural biologist collaborator or by downloading an entry from the Protein Data Bank (PDB). Usually these structures are not ready to use as they will likely have crystallisation products and will require fixing to obtain the desired protonation state of the protein.</p>
<section id="cleaning-the-structural-coordinates-of-the-biomolecule-of-interest">
<h3>Cleaning the structural coordinates of the biomolecule of interest<a class="headerlink" href="#cleaning-the-structural-coordinates-of-the-biomolecule-of-interest" title="Permalink to this heading"></a></h3>
<p>The structures should be cleaned of all those molecules that are not relevant to your study.
It is worth mentioning here that crystallographic waters are very important for protein stability and enzymatic reactivity and therefore, they should not be discarded without a proper visual assessment.</p>
</section>
<section id="assessing-the-protonation-states-of-your-biomolecule">
<h3>Assessing the protonation states of your biomolecule<a class="headerlink" href="#assessing-the-protonation-states-of-your-biomolecule" title="Permalink to this heading"></a></h3>
<p>As mentioned before, the protonation state of your system should be considered carefully. If you know the pH you want to simulate, you can get a suggested protonation state for your protein using the pKa predictor. The results of these pKa predictors always have to be visually checked, as the protonation patterns are very important in enzymatic reactivity.</p>
<p>Here it is a short list of pKa predictors:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/jensengroup/propka">PROPKA 3</a>: It predicts the pKa values of ionizable groups in proteins and protein-ligand complexes based on the 3D structure.</p></li>
<li><p><a class="reference external" href="http://biophysics.cs.vt.edu">H++ server</a>: It computes pK values of ionizable groups in macromolecules and adds missing hydrogen atoms according to the specified pH of the environment.</p></li>
<li><p><a class="reference external" href="http://compbio.clemson.edu/pka_webserver/">DelphiPKa Web server</a>: It allows to predict pKa’s for ionizable groups in proteins, RNA and DNA.</p></li>
</ul>
</section>
<section id="checking-for-disulphide-bonds-and-other-posttranslational-modifications">
<h3>Checking for disulphide bonds and other posttranslational modifications<a class="headerlink" href="#checking-for-disulphide-bonds-and-other-posttranslational-modifications" title="Permalink to this heading"></a></h3>
<p>Disulphide bonds keep some proteins properly folded, therefore it is very important to look for them in your protein structures. The cysteine residues involved in a disulphide bond should be renamed to the aminoacid code <strong>CYX</strong>. It is worth mentioning that MM forcefields encode each chemical species of each aminoacid residue using a three-letter-code. Since cysteines involved in a disulphide bond lack the hydrogen atom attached to the S atom, they must be named differently (CYX) than the normal cysteine residues (CYS).</p>
<p>It is also important to check for other posttranslational modifications such as phosphorilation or glicosilation of protein residues. You might need to include them in your setup if they are relevant to your hypothesis.</p>
</section>
<section id="presence-of-chromophores-cofactors-substrates-inhibitors-and-other-organic-molecules">
<h3>Presence of chromophores, cofactors, substrates, inhibitors and other organic molecules<a class="headerlink" href="#presence-of-chromophores-cofactors-substrates-inhibitors-and-other-organic-molecules" title="Permalink to this heading"></a></h3>
<p>Classical forcefields contain parameters for the most common residues in biomolecular simulations such as aminoacids, nucleic acids, lipids, sugars, ions and water molecules. Unfortunately, drug-like molecules, most chromophores and other organic molecules of interest of your biological system are not included in those forcefields and must be parameterised explicitly.</p>
<p>There are several protocols to parameterise organic molecules for each forcefield as well as several web servers that provide parameters for organic molecules. We are going to list here a set of tutorials for ligand parameterisation and a list of web servers created for that same purpose. Additionally, we also include some databases of parameterised molecules.</p>
<p><strong>Ligand parameterisation protocols:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://ambermd.org/tutorials/ForceField.php">AMBER tutorials for developing non standard parameters</a>: The AMBER project provides you with 6 tutorials on how to parameterise different non standard residues such as organic molecules, covalent ligands and metal ions.</p></li>
<li><dl class="simple">
<dt>CHARMM tutorials:</dt><dd><ul>
<li><p><a class="reference external" href="https://www.charmm.org/charmm/documentation/tutorials/">All CHARMM tutorials</a></p></li>
<li><p><a class="reference external" href="https://www.ks.uiuc.edu/Training/Tutorials/science/forcefield-tutorial/forcefield.pdf">CHARMM tutorial on Parameterising novel residues</a></p></li>
<li><p><a class="reference external" href="http://www.ks.uiuc.edu/Research/vmd/plugins/paratool/">Paratool VMD Plugin</a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Web Servers:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="www.swissparam.ch">SwissParam</a>: a web server that provides topology and parameters for small organic molecules compatible with the CHARMM all atoms force field, for use with CHARMM and GROMACS.</p></li>
<li><p><a class="reference external" href="http://www.charmm-gui.org/?doc=input/ligandrm">CHARMM GUI Ligand Reader and Modeller</a>: a web server that provides parameters compatible for CHARMM forcefields.</p></li>
<li><p><a class="reference external" href="https://alanwilter.github.io/acpype/">ACPYPE Server</a> : a web server that generates topology parameters files for unusual organic chemical compounds for AMBER forcefields.</p></li>
<li><p><a class="reference external" href="http://zarbi.chem.yale.edu/ligpargen/">LigParGen web Server</a> : is a web-based service that provides force field (FF) parameters for organic molecules or ligands with the OPLS-AA forcefield.</p></li>
</ul>
<p><strong>Published parameters of organic molecules:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="http://research.bmh.manchester.ac.uk/bryce/amber/">AMBER parameter database</a> : Parameters for use  with the AMBER forcefield for an extensive list of cofactors and other organic molecules.</p></li>
<li><p><a class="reference external" href="https://github.com/t-/amber-dyes">AMBER DYES forcefield</a> : Parameters for use with the AMBER forcefield for the most common dyes.</p></li>
</ul>
<p>Additionally, it is worth mentioning the <a class="reference external" href="https://openforcefield.org">Open Force Field Initiative</a> which is actively working to develop new forcefields that escape from typical forcefield atomtypes and use chemical perception to parameterise organic molecules.</p>
<p>The parameters for the small molecules obtained with the aforementioned methods are probably not as accurate as the rest of the MM forcefield used in the setup. There is a lot of effort in the parameterisation and validation of forcefields for proteins, nucleic acids and solvent molecules. However, if you plan to include that small molecule in the QM region in the final QM/MM simulation, it will probably be enough to successfully equilibrate the system at the MM level. In QM/MM simulation, these parameters will be no longer used as the molecule will be described using a more accurate QM level of theory.</p>
<p>If that is not your case and your small molecule will be included in the MM region, a more extensive validation of the MM parameters is required. Usually running a short molecular dynamics simulation of the solvated ligand can expose problems in the parameterisation process.</p>
</section>
</section>
<section id="preparing-topology-and-coordinate-files-for-cp2k">
<h2>Preparing topology and coordinate files for CP2K<a class="headerlink" href="#preparing-topology-and-coordinate-files-for-cp2k" title="Permalink to this heading"></a></h2>
<p>CP2K allows several formats for topology files (you can find the complete list here: <a class="reference external" href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/SUBSYS/TOPOLOGY.html">&amp;TOPOLOGY</a> under the <strong>&amp;CONN_FILE_FORMAT</strong> and the <strong>&amp;COORD_FILE_FORMAT</strong> subsections). For biomolecular modelling purposes, the most convenient formats are AMBER formats (AMBER7 topology files, AMBER7 CRD files) and CHARMM formats (PSF, PDB).</p>
<p>Since both AMBER and CHARMM software packages have excellent training material, here we are going to give a quick overview of the system preparation process and provide a list of useful tutorials for each software package. We will highlight how to adapt those protocols to the specific requirements of CP2K.</p>
<p><strong>1) System building</strong></p>
<p>It is crucial to build your model system in a way that represents the biological process you want to study in the most accurate way possible. You should include all of the key elements of your system you have investigated beforehand.</p>
<p>In order to prepare a suitable model system, you should:
- Include water molecules when possible
- Create bonds for special features as disulphide bonds, covalent molecules
- Use a cubic or triclinic periodic box (This is a requirement to run QM/MM simulations in parallel in CP2K.)
- Neutralise the system in order to avoid simulation artefacts.</p>
<p><strong>2) Minimisation, thermalisation and equilibration using MM forcefields</strong></p>
<p>After you have built your topology and coordinate files, you must minimise these coordinates using the forcefield parameters in your topology file. Energy minimisation will find an energy minimum in the potential energy surface of your system and fix any possible bad contacts in your initial structure. If possible, it is important that you use minimise using a steepest descent algorithm at first to avoid getting stuck in a local minimum, and subsequently refine the structure by minimising with the conjugate gradient algorithm.</p>
<p>Once the system is minimised, it has to be subsequently heated (from 0K to your target conditions e.g. 300K) and equilibrated. Since a sudden increase in the kinetic energy of your system may lead to system instabilities, a gradual and slow heating process is recommended where possible.</p>
<p>Afterwards the pressure and volume of the system must be equilibrated. However, the nature of your simulation (for instance globular and membrane proteins) might require a specific equilibration recipe. Therefore, we will point out at the end of this page several tutorials that cover the specifics of each kind of simulation.</p>
<p>As a general rule, you should check that all the fixed quantities of the ensemble that you use (NVT, NPT, NVE …) are stable before you start your production runs. It is also wise to assess the stability of your biomolecule during all the themalisation and equilibration process.</p>
<p>It is worth mentioning that the equilibrated system using MM forcefield will be equilibrated at this level of theory only, it will have to be equilibrated again at the QM/MM level of theory (see <strong>4) Monitorisation using QM/MM methods</strong> ) before starting the QM/MM production runs.</p>
<p><strong>3) Adding missing parameters to the MM forcefield</strong></p>
<p>The current AMBER and CHARMM forcefields were developed to reproduce the behaviour of biomolecules using classical mechanics. In this context, hydrogen atoms of standard residues and water molecules are parameterised without Lennard-Jones parameters. MM forcefields account for these missing parameters and simulations are usually performed with hydrogen restraining algorithms such as SHAKE, SETTLE or LINKS that freeze the X-H bond vibration frequency in order to increase the simulation timestep.</p>
<p>However, these approximations cannot be done in quantum mechanics. In particular, in QM/MM simulations they lead to unnatural interactions between the point charges of the MM subsystem with the electronic densities of the QM subsystem, which eventually cause the simulation to crash. Therefore, you have to add the missing parameters for hydrogens at least in the QM/MM interface.</p>
<p>There are two ways to add the Lennard-Jones parameters to the forcefield:</p>
<ul class="simple">
<li><p>to add the Lennard-Jones parameters in the CP2K input file within the &amp;QMMM subsection of the &amp;FORCE_EVAL section. You must specify the Lennard-Jones parameters for each kind of pairwise interaction involving an hydrogen atom using the following format:</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&amp;QMMM
...
  &amp;FORCEFIELD
    &amp;NONBONDED
      &amp;LENNARD-JONES
          ATOMS HW O
          EPSILON [kcalmol] 0.058
          SIGMA [angstrom]  2.2612
          RCUT [angstrom] 9.0
      &amp;END
    &amp;END
  &amp;END
</pre></div>
</div>
<ul class="simple">
<li><p>to modify the Lennard-Jones parameters directly in the topology file. AMBERtools provides a tool to modify PARM7 topology files named <strong>parmed</strong>. More details on how to do this can be found in the <a class="reference external" href="https://parmed.github.io/ParmEd/html/index.html">parmed documentation</a> .</p></li>
</ul>
<p>Also, if you are using a QM region that shares a covalent bond with the MM region, you must make sure that the MM subsystem remains neutral as a charge imbalance in the MM subsystem can lead to important simulation artefacts. Therefore you must modify the charges of the MM region, usually those of molecule that is split between the two regions. If you are using an AMBER topology, you can easily modify the topology using <strong>parmed</strong>.</p>
<p><strong>4) Monitorisation using QM/MM methods</strong></p>
<p>Once the topology is amended and coordinates of the system are properly equilibrated, we are ready to start the QM/MM simulations. It is recommended to perform a short monitorisation simulation using the QM/MM of choice before starting the production runs in order to assess the stability of the QM/MM interface.</p>
<section id="system-preparation-using-ambertools-software-package">
<h3>System preparation using AMBERTools software package<a class="headerlink" href="#system-preparation-using-ambertools-software-package" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="https://ambermd.org/AmberTools.php">AMBERTools</a> is a free suite provided by the AMBER software package developers that provides all the tools needed to prepare a biological system. It includes AMBER forcefields for proteins, lipids, sugars, nucleic acids and drug-like molecules. Also provides all the tools needed to derive ad-hoc parameters for special residues such as chromophores and other organic molecules. AMBER also provides a lot of useful <a class="reference external" href="https://ambermd.org/tutorials/">tutorials</a>.</p>
<p>AMBER also provide detailed tutorials for different kinds of biomolecules:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://amberhub.chpc.utah.edu/analisis-of-nucleic-acid-simulation/">Nucleic acids</a></p></li>
<li><p><a class="reference external" href="http://ambermd.org/tutorials/basic/tutorial0/index.php">Globular proteins</a></p></li>
<li><p><a class="reference external" href="https://ambermd.org/tutorials/advanced/tutorial16/index.php">Membrane proteins</a></p></li>
</ul>
</section>
<section id="system-preparation-using-charmm-software-package">
<h3>System preparation using CHARMM software package<a class="headerlink" href="#system-preparation-using-charmm-software-package" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="https://www.charmm.org/charmm/">CHARMM</a> (Chemistry at HARvard Molecular Mechanics) is a molecular simulation program developed with a primary focus on molecules of biological interest. CHARMM contains a comprehensive set of analysis and model building tools. CHARMM also has a lot of useful <a class="reference external" href="https://www.charmm.org/charmm/documentation/tutorials/">tutorials</a> .</p>
<p>CHARMM has several tutorials to perform MD simulations of biomolecules:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.charmm-gui.org/">CHARMM GUI web server</a></p></li>
<li><p><a class="reference external" href="https://www.charmmtutorial.org/index.php/Full_example">Globular proteins</a></p></li>
<li><p><a class="reference external" href="http://www.charmm-gui.org/?doc=tutorial&amp;project=membrane">Membrane proteins</a></p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../overview/overview.html" class="btn btn-neutral float-left" title="QM/MM overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="selecting_qm_atoms.html" class="btn btn-neutral float-right" title="Selecting QM atoms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>